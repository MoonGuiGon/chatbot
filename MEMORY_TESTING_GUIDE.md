# 🧠 메모리 시스템 테스트 가이드

## 🎯 빠른 테스트 시나리오

### 시나리오 1: 대화 컨텍스트 유지 테스트 (단기 메모리)

**목적**: 같은 대화 내에서 이전 내용을 기억하는지 확인

1. 새 대화 시작
2. **첫 번째 질문**: "부품 ABC-12345의 재고는?"
   - 봇이 재고 정보 답변
3. **두 번째 질문**: "그 부품의 최근 출고 이력도 알려줘"
   - ✅ **기대 결과**: "그 부품"이 ABC-12345임을 기억하고 출고 이력 제공
4. **세 번째 질문**: "그거 검사 이력은?"
   - ✅ **기대 결과**: 여전히 ABC-12345의 검사 이력 제공

**검증 포인트**:
- 대명사("그 부품", "그거") 참조가 정확히 작동
- 대화 흐름이 자연스러움
- 10개 메시지 이내에서 모든 이전 대화 기억

---

### 시나리오 2: 사용자 선호도 학습 테스트 (장기 메모리)

**목적**: 사용자 선호도를 저장하고 다른 대화에서도 적용하는지 확인

#### 2-1. 선호도 설정
1. 새 대화 시작
2. **질문**: "앞으로 표 형식으로 답변해줘"
   - 봇이 확인 응답
3. 계속 대화하며 10개 이상 메시지 주고받기
   - 💡 **자동 저장**: 10개 메시지마다 중요 정보 자동 추출
4. **설정 확인**:
   - 우측 상단 ⚙️ 설정 버튼 클릭
   - "메모리 관리" 탭 클릭
   - ✅ **기대 결과**: "선호도" 카테고리에 "표 형식 답변 선호" 메모리 저장됨

#### 2-2. 새 대화에서 선호도 적용
1. "새 대화" 버튼 클릭 (새 conversation_id)
2. **질문**: "부품 재고 현황 알려줘"
   - ✅ **기대 결과**: 자동으로 표 형식으로 답변 (선호도 기억)

---

### 시나리오 3: 역할 기반 맥락화 테스트

**목적**: 사용자 역할을 기억하고 관련 정보를 우선 제공하는지 확인

#### 3-1. 역할 설정
1. 새 대화 시작
2. **질문**: "나는 생산팀 라인 1 담당이야"
   - 봇이 확인 응답
3. 10개 이상 메시지 주고받아 메모리 자동 저장 트리거
4. **메모리 확인**:
   - 설정 → 메모리 관리
   - ✅ "역할" 카테고리에 "생산팀 라인 1 담당" 저장됨

#### 3-2. 역할 기반 답변
1. 새 대화 시작
2. **질문**: "부품 ABC-12345 정보 알려줘"
   - ✅ **기대 결과**: 라인 1 관련 정보를 우선적으로 제공
   - 예: "라인 1로의 최근 출고", "라인 1에 장착된 장비" 등

---

### 시나리오 4: 명시적 기억 요청 테스트

**목적**: 사용자가 "기억해줘" 요청한 내용을 확실히 저장하는지 확인

1. 새 대화 시작
2. **질문**: "부품 ABC-12345는 우리 팀 핵심 부품이야. 이거 꼭 기억해줘"
   - 봇이 "기억하겠습니다" 응답
3. 10개 이상 메시지로 자동 저장 트리거
4. **메모리 확인**:
   - 설정 → 메모리 관리
   - ✅ "명시적요청" 카테고리에 "ABC-12345는 핵심 부품" 저장됨
   - 중요도: **high** (명시적 요청은 높은 중요도)
5. **다음 대화에서**:
   - **질문**: "핵심 부품 상태 확인"
   - ✅ **기대 결과**: ABC-12345를 핵심 부품으로 인식하고 정보 제공

---

### 시나리오 5: 메모리 수동 관리 테스트

**목적**: UI를 통한 메모리 직접 추가/삭제가 정상 작동하는지 확인

#### 5-1. 수동 메모리 추가
1. 설정 ⚙️ → "메모리 관리" 탭
2. "추가" 버튼 클릭
3. 입력:
   - **카테고리**: "역할"
   - **키워드**: "부서"
   - **내용**: "품질팀"
   - **중요도**: "high"
4. "추가" 버튼 클릭
5. ✅ **기대 결과**: 메모리 목록에 즉시 표시

#### 5-2. 추가한 메모리 적용 확인
1. 새 대화 시작
2. **질문**: "부품 검사 정보 알려줘"
   - ✅ **기대 결과**: 품질팀 관점의 답변 (검사, 불량률 등 강조)

#### 5-3. 메모리 삭제
1. 설정 → 메모리 관리
2. 특정 메모리의 🗑️ 버튼 클릭
3. ✅ **기대 결과**: 메모리가 목록에서 즉시 제거
4. 새 대화에서 해당 정보 더 이상 적용 안됨

#### 5-4. 전체 초기화
1. 설정 → 메모리 관리
2. "초기화" 버튼 클릭
3. 확인 대화창에서 "확인"
4. ✅ **기대 결과**: 모든 메모리 삭제, 목록 비어있음

---

## 🔍 상세 검증 포인트

### API 레벨 테스트

브라우저 개발자 도구 (F12) → Network 탭에서 확인:

#### 1. 메모리 조회
```
GET /api/memory/user_demo
Response:
{
  "success": true,
  "user_id": "user_demo",
  "memories": [
    {
      "_id": "...",
      "category": "선호도",
      "key": "답변 형식",
      "value": "표 형식 선호",
      "importance": "high"
    }
  ],
  "total": 1
}
```

#### 2. 메모리 통계
```
GET /api/memory/stats/user_demo
Response:
{
  "success": true,
  "total_memories": 5,
  "by_category": {
    "선호도": 2,
    "역할": 1,
    "자주조회": 1,
    "명시적요청": 1
  },
  "by_importance": {
    "high": 2,
    "medium": 2,
    "low": 1
  }
}
```

#### 3. 메모리 추가
```
POST /api/memory/user_demo/manual
Body:
{
  "category": "역할",
  "key": "부서",
  "value": "생산팀",
  "importance": "high"
}
Response:
{
  "success": true,
  "message": "메모리가 저장되었습니다."
}
```

#### 4. 자동 메모리 저장
```
POST /api/memory/user_demo/save
Body:
{
  "conversation_id": "conv-xyz"
}
Response:
{
  "success": true,
  "saved_count": 3,
  "message": "3개의 중요 정보를 저장했습니다."
}
```

---

## 🎨 UI/UX 검증

### 메모리 패널 표시
- ✅ 카테고리별 색상 구분:
  - 선호도: 파란색
  - 역할: 보라색
  - 자주조회: 하늘색
  - 명시적요청: 주황색
  - 업무컨텍스트: 초록색
- ✅ 중요도 배지:
  - high: 빨간색
  - medium: 주황색
  - low: 회색
- ✅ 통계 표시: "총 N개의 정보가 저장되어 있습니다"
- ✅ 빈 상태 메시지: "아직 저장된 메모리가 없습니다"

### 메모리 추가 Dialog
- ✅ 5가지 카테고리 선택 가능
- ✅ 키워드/내용 필수 입력 검증
- ✅ 3가지 중요도 선택
- ✅ 입력 없으면 "추가" 버튼 비활성화

---

## 🧪 Mock 데이터 동작 확인

### Mock LLM이 메모리 추출하는 방식

현재 TEST_MODE에서는 다음과 같이 시뮬레이션:

```python
# Mock LLM의 메모리 추출 (간단한 키워드 기반)
if "생산팀" in conversation or "품질팀" in conversation:
    → [{"category": "역할", "key": "부서", "value": "생산팀", "importance": "high"}]

if "표 형식" in conversation:
    → [{"category": "선호도", "key": "답변 형식", "value": "표 형식 선호", "importance": "medium"}]

if "기억해" in conversation:
    → [{"category": "명시적요청", "key": "...", "value": "...", "importance": "high"}]
```

실제 LLM에서는 더 정교한 분석으로 중요 정보 추출!

---

## 📊 테스트 체크리스트

### 단기 메모리 (대화 컨텍스트)
- [ ] 같은 대화 내에서 이전 메시지 참조 가능
- [ ] 대명사("그 부품", "그거") 정확히 해석
- [ ] 최대 10개 메시지 페어 유지
- [ ] 새 대화 시작하면 이전 대화 컨텍스트 초기화

### 장기 메모리 (사용자 정보)
- [ ] 10개 메시지마다 자동 저장
- [ ] 5가지 카테고리 분류 정확
- [ ] 중요도 구분 (high/medium/low)
- [ ] 새 대화에서도 메모리 적용
- [ ] 사용자 재접속해도 메모리 유지

### UI 기능
- [ ] 설정 → 메모리 관리 탭 접근
- [ ] 저장된 메모리 목록 표시
- [ ] 카테고리/중요도별 색상 구분
- [ ] 통계 정보 표시
- [ ] 메모리 수동 추가 가능
- [ ] 메모리 개별 삭제 가능
- [ ] 전체 초기화 가능

### API 동작
- [ ] GET /api/memory/{user_id} 정상 작동
- [ ] POST /api/memory/{user_id}/manual 정상 작동
- [ ] DELETE /api/memory/{user_id}/{memory_id} 정상 작동
- [ ] POST /api/memory/{user_id}/clear 정상 작동
- [ ] GET /api/memory/stats/{user_id} 정상 작동

---

## 🚨 알려진 제한사항 (TEST_MODE)

1. **Mock 메모리 추출**: 실제 LLM 대신 키워드 매칭 사용
   - 실제 환경에서는 LLM이 더 정교하게 중요 정보 식별
2. **MongoDB Mock**: 메모리에 저장 (서버 재시작하면 초기화)
   - 실제 환경에서는 MongoDB에 영구 저장
3. **자동 저장 주기**: TEST_MODE에서는 3개 메시지로 설정
   - 실제 환경에서는 10개 메시지 권장

---

## 💡 트러블슈팅

### 문제 1: 메모리가 저장되지 않아요
**해결**:
- 최소 10개 메시지 (user + assistant = 5턴) 주고받았는지 확인
- 설정 → 메모리 관리에서 확인
- F12 → Console에서 에러 메시지 확인

### 문제 2: 새 대화에서 메모리가 적용 안돼요
**해결**:
- 메모리가 실제로 저장되었는지 확인 (설정 → 메모리 관리)
- 페이지 새로고침 후 다시 시도
- user_id가 동일한지 확인 (현재: user_demo)

### 문제 3: 메모리 삭제가 안돼요
**해결**:
- 서버 재시작 (./stop_test.sh && ./start_test.sh)
- 브라우저 캐시 삭제 (Cmd+Shift+R)

---

## 🎓 다음 단계

메모리 시스템 테스트 완료 후:
1. ✅ 실제 MongoDB 연결하여 영구 저장 테스트
2. ✅ 실제 LLM으로 정교한 메모리 추출 테스트
3. ✅ 다양한 사용자 시나리오로 확장 테스트
4. ✅ 성능 최적화 (메모리 조회 캐싱, 인덱싱)

---

**메모리 시스템으로 더 똑똑한 챗봇!** 🧠✨
